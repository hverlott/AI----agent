# AI客服管理工具

版本: V2.1
> 本文档汇总当前系统全部功能（PRO），每项功能均包含功能描述与操作说明。

## 1. 启动与基础环境

### 1.1 启动单平台后台（Telegram）
- 描述：进入 Telegram 管理后台，进行配置、群发、日志、统计等操作。
- 操作：
  1) 运行 `start_admin.bat`（Windows）或 `start_admin.sh`（Linux）。
  2) 浏览器打开控制台页面（默认端口 8501）。

### 1.2 启动多平台后台
- 描述：进入多平台管理后台，统一管理 Telegram / WhatsApp 等平台。
- 操作：
  1) 运行 `start_multi_admin.bat`（Windows）或 `start_multi_admin.sh`（Linux）。
  2) 在页面左侧选择平台并进入对应面板。

### 1.3 环境变量检查
- 描述：校验 AI 与 Telegram 所需环境变量是否配置完整。
- 操作：
  1) 确认 `.env` 文件存在。
  2) 在后台“配置”面板查看环境状态提示。
### 1.4 UI布局与视觉优化
- 描述：优化后台布局与视觉层级，提升操作效率与专业感。
- 操作：
  1) 采用顶部状态栏 + 左侧导航 + 主区域分区布局。
  2) 关键操作区（启动/停止/群发）置顶并强调。
  3) 统计卡片统一样式，支持移动端自适应。

## 2. Telegram 功能

### 2.0 Telegram 机器人创建说明
- 描述：完成 Telegram API 创建与登录准备，生成机器人会话。
- 操作：
  1) 打开 https://my.telegram.org，登录后进入 API Development Tools。
  2) 创建应用并获取 `TELEGRAM_API_ID` 与 `TELEGRAM_API_HASH`。
  3) 在项目根目录创建/更新 `.env`，写入上述两项配置。
  4) 运行后台后在“未登录 Telegram（点击登录）”完成手机号登录，生成 `userbot_session.session`。
  5) 登录成功后即可启动机器人并正常工作。

### 2.1 机器人启停与状态监控
- 描述：启动、停止、重启 Telegram 机器人，并查看运行状态。
- 操作：
  1) 进入 Telegram 面板。
  2) 点击“启动 / 停止 / 重启”按钮。
  3) 查看状态卡片（运行/停止、PID）。

### 2.2 Telegram 登录（未登录时面板登录）
- 描述：当未登录时直接在面板完成 Telegram 登录。
- 操作：
  1) 未登录提示处点击“未登录 Telegram（点击登录）”。
  2) 在登录面板输入手机号。
  3) 点击“获取验证码”，输入验证码；如有二次密码则输入。
  4) 点击“登录”完成绑定。

### 2.3 AI 人设配置
- 描述：设置 AI 回复风格（提示词），即时生效。
- 操作：
  1) 进入 Telegram 面板 → “配置”。
  2) 编辑“AI 人设”文本框。
  3) 点击“保存人设”。

### 2.4 关键词触发配置
- 描述：配置群聊触发关键词，命中后才触发回复。
- 操作：
  1) 进入 Telegram 面板 → “配置”。
  2) 编辑“触发关键词”文本框（每行一个）。
  3) 点击“保存关键词”。

### 2.5 功能开关（私聊/群聊/上下文）
- 描述：开启或关闭私聊回复、群聊回复、群聊上下文自动回复。
- 操作：
  1) 进入 Telegram 面板 → “配置”。
  2) 切换“私聊自动回复 / 群聊自动回复 / 群聊上下文回复”。
  3) 点击“保存开关”。

### 2.6 群聊白名单管理
- 描述：限制机器人仅对选中的群聊自动回复。
- 操作：
  1) 进入 Telegram 面板 → “配置”。
  2) 在群聊列表中多选白名单群。
  3) 如群不在列表可在“补充群ID”手动填写。
  4) 点击“保存群聊白名单”。

### 2.7 群发（多选群组 + 间隔 + 发送记录）
- 描述：批量群发消息，可按白名单/非白名单/全部筛选，多选群组并设置发送间隔，生成发送记录。
- 操作：
  1) 进入 Telegram 面板 → “群发”。
  2) 选择群组加载方式（全部 / 仅白名单 / 非白名单）。
  3) 点击“加载群组”，在列表中多选目标群。
  4) 输入群发内容，设置“群发间隔（秒）”。
  5) 点击“开始群发”，查看发送记录表。

### 2.8 Q&A 问题库回复
- 描述：命中预设问题库时直接返回固定答案。
- 操作：
  1) 编辑 `platforms/telegram/qa.txt`，格式为 `问题||答案`。
  2) 保存后无需重启，命中即自动回复。

### 2.9 统计报表
- 描述：查看机器人消息量、回复量、成功率等统计。
- 操作：
  1) 进入 Telegram 面板 → “统计”。
  2) 查看指标卡与明细信息。
  3) 可点击“重置统计”清零。

### 2.10 运行日志（系统/私聊/群聊）
- 描述：按类型查看系统日志、私聊日志、群聊日志，并支持手动加载和清空。
- 操作：
  1) 进入 Telegram 面板 → “日志”。
  2) 点击“加载日志”刷新内容。
  3) 切换日志标签查看不同类型。
  4) 点击“清空日志”清理对应日志。
### 2.11 日志导出与存档（Telegram）
- 描述：支持日志导出与按日期归档，重启不丢失，便于后续检索。
- 操作：
  1) 进入 Telegram 面板 → “日志”，点击“导出”选择日期范围与格式（CSV/JSON）。
  2) 日志自动按日期存档，支持搜索与下载。
  3) 可在“日志”面板设置保留天数与自动清理策略。

## 3. WhatsApp 功能

### 3.1 WhatsApp 登录二维码
- 描述：显示二维码并完成 WhatsApp 登录。
- 操作：
  1) 进入 WhatsApp 面板。
  2) 展开二维码面板，用手机 WhatsApp 扫码。
  3) 点击“刷新查看状态”确认登录。

### 3.2 WhatsApp 机器人启停
- 描述：启动 / 停止 / 重启 WhatsApp 机器人。
- 操作：
  1) 进入 WhatsApp 面板。
  2) 点击“启动 / 停止 / 重启”按钮。

### 3.3 WhatsApp AI 人设与关键词
- 描述：设置 WhatsApp AI 人设与群聊关键词。
- 操作：
  1) 进入 WhatsApp 面板 → “配置”。
  2) 修改“AI 人设”和“触发关键词”。
  3) 点击保存。

### 3.4 WhatsApp 开关配置
- 描述：控制私聊/群聊自动回复开关。
- 操作：
  1) 进入 WhatsApp 面板 → “配置”。
  2) 勾选或取消相关开关。
  3) 点击保存。

### 3.5 WhatsApp 日志
- 描述：查看 WhatsApp 机器人日志并支持刷新/清空。
- 操作：
  1) 进入 WhatsApp 面板 → “日志”。
  2) 点击“刷新日志”或“清空日志”。

### 3.6 WhatsApp 统计
- 描述：查看 WhatsApp 消息与回复统计。
- 操作：
  1) 进入 WhatsApp 面板 → “统计”。
  2) 查看统计指标与运行时长。
### 3.7 日志导出与存档（WhatsApp）
- 描述：支持日志导出与按日期归档，重启不丢失，便于后续检索。
- 操作：
  1) 进入 WhatsApp 面板 → “日志”，点击“导出”选择日期范围与格式（CSV/JSON）。
  2) 日志自动按日期存档，支持搜索与下载。
  3) 可在“日志”面板设置保留天数与自动清理策略。

## 4. 多平台管理能力

### 4.1 平台切换
- 描述：在多平台后台中快速切换 Telegram / WhatsApp。
- 操作：
  1) 左侧选择平台卡片。
  2) 主面板显示对应平台功能。

### 4.2 平台状态总览
- 描述：显示各平台运行/登录/配置状态。
- 操作：
  1) 打开多平台后台。
  2) 查看顶部状态卡与平台状态提示。

## 5. 文件与配置入口

### 5.1 Telegram 核心配置文件
- 描述：可直接编辑核心配置文件并即时生效。
- 操作：
  1) `platforms/telegram/prompt.txt`（人设）
  2) `platforms/telegram/keywords.txt`（关键词）
  3) `platforms/telegram/config.txt`（开关）
  4) `platforms/telegram/qa.txt`（Q&A）

### 5.2 Telegram 日志文件
- 描述：系统/私聊/群聊日志存储与归档位置。
- 操作：
  1) `platforms/telegram/logs/system.log`
  2) `platforms/telegram/logs/private.log`
  3) `platforms/telegram/logs/group.log`
  4) `platforms/telegram/logs/archive/`

---

## 6. 部署与启动

### 6.1 安装依赖
- 描述：安装 Python 与依赖包，保证后台和机器人可运行。
- 操作：
  1) 运行 `install.bat`（Windows）或 `install.sh`（Linux）。
  2) 若需手动安装，执行 `pip install -r requirements.txt`。

### 6.2 启动顺序建议
- 描述：建议先启动后台，再启动机器人，便于观察日志与状态。
- 操作：
  1) 先启动后台：`start_admin.bat` 或 `start_multi_admin.bat`。
  2) 在后台完成配置后点击“启动”机器人。

### 6.3 端口与访问
- 描述：Streamlit 后台默认端口 8501，多后台可使用不同端口。
- 操作：
  1) 单后台默认访问 `http://localhost:8501`。
  2) 若端口冲突，可使用 `streamlit run admin.py --server.port 8502` 启动。

## 7. 故障排查

### 7.1 后台打不开或白屏
- 描述：检查脚本异常或依赖缺失。
- 操作：
  1) 在控制台查看报错信息。
  2) 运行 `python -m py_compile admin.py admin_multi.py main.py` 检查语法。
  3) 确认已安装依赖：`pip install -r requirements.txt`。

### 7.2 Telegram 无法登录
- 描述：检查 API 配置与会话冲突。
- 操作：
  1) 确认 `.env` 中 ``TELEGRAM_API_ID`` 与 ``TELEGRAM_API_HASH`` 正确。
  2) 确保机器人已停止后再登录，避免 session 锁定。
  3) 若需要二次密码，按提示输入 2FA 密码。

### 7.3 AI 无响应或报错
- 描述：AI 接口配置错误或网络问题。
- 操作：
  1) 确认 `.env` 中 `AI_API_KEY`、`AI_BASE_URL`、`AI_MODEL_NAME` 正确。
  2) 查看系统日志中的错误信息定位原因。
  3) 若网络受限，确认服务器可访问 AI 接口。

### 7.4 群发失败或无响应
- 描述：可能是账号限制、数据库锁定或群聊选择异常。
- 操作：
  1) 先停止机器人，再进行群发操作。
  2) 缩小群发数量进行小批量测试（3-5 条）。
  3) 检查发送记录表中的失败原因。

## 8. 数据库锁定处理（Telegram）

### 8.1 锁定原因说明
- 描述：Telethon 会话文件被机器人占用时，后台操作可能出现数据库锁定。
- 操作：
  1) 停止 Telegram 机器人。
  2) 等待 3-5 秒后再进行群发或读取分组。

### 8.2 锁定后恢复
- 描述：解除锁定并恢复后台功能。
- 操作：
  1) 在后台点击“停止机器人”。
  2) 确认进程已停止后再执行“加载分组/群发”。
  3) 若仍锁定，重启后台或系统后再试。

### 8.3 减少锁定概率
- 描述：使用独立 session 并减少并发操作。
- 操作：
  1) 避免同时运行机器人与后台群发。
  2) 群发前先停止机器人。
  3) 保持会话文件稳定，不要频繁删除 session 文件。







