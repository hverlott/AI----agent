# 使用教程 / User Guide

本教程提供图文并茂的操作说明，覆盖安装、首启、配置与群发、日志与故障排查。  
This guide provides illustrated instructions for install, first-run, configuration, broadcasting, and troubleshooting.

## 1. 安装与启动 / Install & Launch
- Windows:
  1) 运行 `install.bat`
  2) 复制 `.env.example` 为 `.env` 并填写密钥
  3) 执行 `start_admin.bat` 打开管理后台
- Linux/Mac:
  1) `chmod +x install.sh && ./install.sh`
  2) `cp .env.example .env` 并填写密钥
  3) `./start_admin.sh` 启动后台

首登 Telegram：  
First Telegram login:
```bash
python main.py
# 按提示输入手机号、验证码、云密码（如启用两步验证）
```

## 2. 管理后台总览 / Admin Overview
打开浏览器访问 `http://localhost:8501`。  
Open browser at `http://localhost:8501`.

截图（≥1280×720）：  
Screenshot (≥1280×720):
- 管理后台多平台面板 / Multi-platform dashboard:  
  `docs/images/05-管理后台多平台面板.png`

标注说明 / Annotations:
- 左侧平台选择切换 Telegram/WhatsApp
- 顶部状态指示显示连接与会话信息
- 右侧标签页包含日志、群发、AI配置、系统信息

补充（当前版本）：
- 首次进入后台会出现“系统登录”表单，需要使用系统账号登录。
- 侧边栏包含「租户ID」输入框：SuperAdmin 可切换租户，BusinessAdmin 只读固定租户。
- 「🤖 AI 配置中心」分组下新增：🧪 AI学习中心、🧩 技能中心。

## 2.1 AI学习中心 / AI Learning Center
入口：左侧菜单「🤖 AI 配置中心」>「🧪 AI学习中心」。

1) 在「📄 数据浏览与清洗」中按平台/方向/可学习/垃圾/绑定AI筛选
2) 勾选记录后批量标记“可学习/垃圾”、绑定 AI、写入标签
3) 在「📦 导出学习集」中导出 JSONL 文件（按租户目录隔离）

## 2.2 Skills 技能中心 / Skills Center
入口：左侧菜单「🤖 AI 配置中心」>「🧩 技能中心」。

1) 在「➕ 新增/编辑」中创建技能并启用
2) 选择适用回复路径（kb_only/script_only/both）并可绑定到 AI 业务线
3) 在「📋 技能列表」中查看、删除技能（需勾选确认删除）

## 3. AI 话术配置 / AI Persona & Keywords
- 话术人设（`prompt.txt`）支持热更新，修改后立即生效
- 触发关键词（`keywords.txt`）用于群聊关键词响应
- 模型与服务商在后台面板中切换（DeepSeek/OpenAI/兼容端点）

操作步骤 / Steps:
1) 打开“🧠 话术配置”标签页  
2) 左侧编辑人设文本；右侧编辑关键词  
3) 点击“保存”，后台将写入配置文件

## 4. 消息群发 / Broadcasting
流程 / Flow:
1) 进入“📢 消息群发”标签页  
2) 点击“加载分组”，选择目标分组  
3) 输入消息内容并确认开始群发  
4) 进度面板显示已发送/失败计数与异常（FloodWait/PeerFlood）

伪代码 / Pseudocode:
```text
for group in selected_groups:
  for member in group.members:
    sleep(random_between(5s, 15s))  # anti-ban delay
    try:
      send_message(member, content)
    except FloodWait as e:
      sleep(e.seconds + jitter)
    except PeerFlood:
      log_warn("peer flood risk; backoff")
```

## 5. 日志与故障排查 / Logs & Troubleshooting
- 实时日志：后台“日志”标签页，支持过滤关键字
- 文件日志：`platforms/telegram/logs/trace.jsonl`
- 常见问题：网络代理、密钥错误、API限流、两步验证、会话冲突

截图 / Screenshot:
- 错误处理与日志归档：`docs/images/09-错误处理与日志归档.png`

## 6. 核心流程图 / Core Flow Diagram
- 整体处理流程：`docs/images/03-telegram-触发与回复流程图.png`
- 架构总览：`docs/images/01-总览架构.png`

## 7. 典型剧本示例 / Typical Script Examples
### 客服问答 / Customer Support Q&A
```
用户：请问发货要多久？
机器人：您好，标准发货时间为 24-48 小时，节假日顺延。
用户：能加急吗？
机器人：可以加急，需额外支付 20 元服务费，是否需要为您办理？
```
### 营销通知 / Marketing Broadcast
```
主题：新品发布
内容：我们推出了 X 系列新品，现参与限时优惠，详情请点击链接。
注意：发送间隔控制在 5-15 秒，避免 PeerFlood。
```

## 8. 兼容性与要求 / Compatibility & Requirements
- Python 3.8+
- Telethon 1.34.0+
- Streamlit 1.30.0+
- 兼容 OpenAI API 格式的推理端点（可配置）

## 9. 安全与合规 / Security & Compliance
- 不提交 `.env`、会话文件、日志与缓存
- 建议启用 gitleaks/trufflehog 扫描与最小权限密钥
- 群发遵守平台政策与地域法律法规

## 修订记录

| 版本号 | 更新日期 | 修改人 | 修改摘要 |
| :--- | :--- | :--- | :--- |
| v2.3.0-docs | 2026-01-09 | Tech Writer | 同步系统登录、AI学习中心与技能中心入口与操作 |
