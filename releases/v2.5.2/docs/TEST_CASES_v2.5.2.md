# v2.5.2 回归测试用例集 (Regression Test Cases)

## 1. 新功能测试 (New Features)

### 1.1 技能中心 (Skill Center)
| 用例ID | 测试场景 | 前置条件 | 操作步骤 | 预期结果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC-SKILL-001 | 技能增删改查 (CRUD) | 数据库连接正常 | 1. 调用 `upsert_skill` 新增技能<br>2. 调用 `list_skills` 查询<br>3. 修改技能状态<br>4. 删除技能 | 1. 技能成功写入数据库<br>2. 列表返回正确数据<br>3. 状态更新成功<br>4. 技能被移除 | P0 |
| TC-SKILL-002 | 技能绑定 AI 模型 | 存在多个 AI 模型 | 1. 创建技能并绑定特定 `bound_ai_id`<br>2. 模拟不同模型请求 | 仅当请求模型匹配 `bound_ai_id` 时返回该技能 | P1 |

### 1.2 内容过滤 (Content Filter)
| 用例ID | 测试场景 | 前置条件 | 操作步骤 | 预期结果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC-FILTER-001 | 高密度关键词拦截 | 开启过滤，阈值 0.5 | 发送消息 "加群加群" (占比 1.0) | 返回 `is_filtered=True`，触发拦截 | P0 |
| TC-FILTER-002 | 低密度关键词放行 | 开启过滤，阈值 0.5 | 发送消息 "你好我想加群" (占比 0.33) | 返回 `is_filtered=False`，放行消息 | P0 |
| TC-FILTER-003 | 过滤功能关闭 | 关闭过滤开关 | 发送高密度关键词消息 | 返回 `is_filtered=False` | P1 |

### 1.3 数据库升级 (Database Upgrade)
| 用例ID | 测试场景 | 前置条件 | 操作步骤 | 预期结果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC-DB-001 | 索引完整性检查 | 数据库初始化完成 | 检查 `message_events` 表索引列表 | 包含 `idx_msg_tenant_time`, `idx_msg_learning`, `idx_msg_chat` | P0 |
| TC-DB-002 | 配置加载优先级 | 数据库存在配置 | 1. 数据库写入配置 A<br>2. 文件存在配置 B<br>3. 调用 `load_config` | 返回配置 A (数据库优先) | P0 |

## 2. 回归测试 (Regression)

### 2.1 核心业务流程
| 用例ID | 测试场景 | 前置条件 | 操作步骤 | 预期结果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC-REG-001 | 消息接收与记录 | 数据库正常 | 模拟 Telegram 消息事件 | 消息正确写入 `message_events` 表 | P0 |
| TC-REG-002 | 租户配置隔离 | 存在多租户 | 分别读取不同租户配置 | 配置互不干扰，正确隔离 | P0 |

### 2.2 知识库 (Knowledge Base)
| 用例ID | 测试场景 | 前置条件 | 操作步骤 | 预期结果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC-KB-001 | 混合检索逻辑 | 存在 QA 与文档 | 模拟用户提问 | 优先返回 QA 匹配，无 QA 时返回向量匹配 | P1 |
