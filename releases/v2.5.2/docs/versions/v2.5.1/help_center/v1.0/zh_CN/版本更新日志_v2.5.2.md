# v2.5.2 版本更新日志

## 📅 发布日期: 2026-01-14

## 🚀 核心更新

### 1. 安全审计全覆盖 (Security & Audit)
*   **WhatsApp 审计闭环**: 修复了 WhatsApp 机器人作为独立孤岛未接入审计系统的重大隐患。现在 WhatsApp 消息发送前会强制调用 `AuditManager` 接口，通过双重审计（关键词+语义）后方可发送。
*   **Fail-Closed 策略**: 当审计服务不可用时，系统将默认拦截发送并返回安全兜底话术，确保合规性。

### 2. 知识库 RAG 引擎升级 (RAG Engine Upgrade)
*   **向量检索支持**: 废弃了基于 `difflib` 的简单文本匹配算法，引入了基于 `OpenAI Embeddings` + `Cosine Similarity` 的向量检索机制。
*   **混合检索架构**: 支持“向量检索”与“关键词匹配”的自动降级策略。当向量服务不可用时，自动回退到文本匹配模式。
*   **重索引工具**: 新增 `tools/reindex_kb.py` 工具，支持一键为现有知识库生成向量索引 (`vectors.pkl`)。

### 3. 技能中心增强 (Skills Enhancement)
*   **Function Calling 支持**: 技能配置现在支持 OpenAI 标准的 `tools` 定义。系统会自动将技能转换为 Function Call 格式透传给 LLM，使其能够输出结构化的工具调用指令（如 `check_order_status`），而不仅仅是纯文本回复。

### 4. AI 学习闭环 (AI Learning Loop)
*   **微调工具链**: 新增 `tools/train_model.py` 脚本。支持直接读取“AI 学习中心”导出的 `.jsonl` 数据，自动上传并触发 OpenAI/DeepSeek 的 Fine-tuning 任务，打通了“数据标注 -> 模型训练”的最后一公里。

### 5. 系统稳定性 (Stability)
*   **监控看板加固**: 修复了系统状态看板解析 Trace 日志时的脆弱性问题，增加了容错机制，防止因单条脏日志导致整个监控页面崩溃。

## 🛠️ 升级指南

1.  **知识库重建**: 升级后请运行 `python tools/reindex_kb.py --tenant default` 生成向量索引。
2.  **WhatsApp 重启**: 需要重启 WhatsApp 机器人进程以应用新的审计逻辑。
3.  **依赖安装**: 请确保安装了 `numpy` 和 `openai>=1.0.0` (已包含在 requirements.txt 中)。

## 📝 数据库迁移预告 (Next Step)
*   计划在下一版本引入 **PostgreSQL + pgvector**，统一替代当前的 SQLite + Pickle 混合存储方案，以提供企业级的数据一致性和查询性能。
