# SaaS AI System v2.5.2 发布说明 (Release Notes)

**发布版本**: v2.5.2  
**发布日期**: 2026-01-15  
**重要性**: 🔴 高 (包含架构升级与数据库迁移)

---

## 🌟 核心亮点 (Highlights)

本次 v2.5.2 版本重点完成了**系统架构的“数据库化”转型**。我们将原本分散在 `config.txt` 等文件的配置全部迁移至数据库存储，支持热更新且无需重启。同时，新增了**在线升级**功能，标志着系统具备了成熟的商业化交付能力。

---

## 🚀 新功能 (New Features)

### 1. ☁️ 智能升级系统 (Smart Upgrade)
- **GitHub 在线升级**: 集成 GitHub API，后台可直接检查最新 Release，一键下载、解压并安装更新。
- **离线包自动升级**: 支持上传 `zip` 更新包，系统自动处理文件替换、备份与版本切换。
- **版本回滚**: 内置版本管理器，若升级失败可秒级回滚至旧版本。

### 2. 🛡️ 可视化内容过滤 (Visual Content Filter)
- **配置面板**: 在 Telegram 配置页新增过滤规则面板。
- **密度检测**: 支持配置关键词密度阈值，自动拦截垃圾推广信息。
- **拦截日志**: 拦截记录自动入库，支持在审计日志中查询。

### 3. 🧩 技能中心 (Skill Center)
- **可视化管理**: 新增技能管理 UI，支持增删改查技能配置。
- **热重载**: 修改技能 JSON 配置后立即生效，无需重启 Bot。

### 4. 🗄️ 企业级数据库支持
- **PostgreSQL 适配**: 新增 `database_pg.py` 驱动，支持无缝切换至 PostgreSQL，满足高并发生产环境需求。
- **混合模式**: 默认保持 SQLite 以确保轻量化，检测到 `DATABASE_URL` 环境变量时自动切换 PG。

---

## ⚡ 优化与改进 (Improvements)

- **性能优化**: 为 `message_events` 表增加了 3 组关键索引（时间倒序、学习标记、会话索引），百万级数据下的查询速度提升 10倍+。
- **打包优化**: 重构 `pack.py`，自动识别并包含 `src` 源码与 `scripts` 迁移工具，生成的升级包更规范（约 1.5MB）。
- **架构文档**: 更新系统时序图，清晰展示了 Filter -> QA -> KB -> Orchestrator 的完整处理链路。
- **UI 修复**: 修正了管理后台版本号显示滞后（原显示 v2.5.1）的问题，增加了版本状态检测。

---

## ⚠️ 升级注意事项 (Upgrade Notes)

**数据库迁移 (必须)**:
由于配置存储方式变更，从 v2.5.1 或更早版本升级时，**必须**在部署后执行一次迁移脚本，否则 Bot 将无法读取旧配置：

```bash
# Windows
python scripts/migrate_to_db.py

# Linux
source .venv/bin/activate && python scripts/migrate_to_db.py
```
