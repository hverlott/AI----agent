# AI Orchestrated Conversation System - Upgrade Guide & Release Notes

> **Current Version**: 2.0.0  
> **Last Updated**: 2026-01-07  
> **Status**: Production Ready (Stable)

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†ä»å•è½®å¯¹è¯ç³»ç»Ÿ (v1.0) å‡çº§è‡³å¤šé˜¶æ®µç¼–æ’ç³»ç»Ÿ (v2.0) çš„å®Œæ•´æµç¨‹ã€å˜æ›´è¯¦æƒ…åŠåº”æ€¥æ–¹æ¡ˆã€‚

---

## 1. ç‰ˆæœ¬å˜æ›´è®°å½• (Changelog)

### v2.0.0 - The "Orchestration" Update (2026-01-07)
**æ ¸å¿ƒå˜æ›´**: å¼•å…¥ Supervisor Agent ä¸çŠ¶æ€æœºï¼Œå®ç°é•¿é“¾è·¯é”€å”®å¯¼å‘å¯¹è¯ã€‚

- **ğŸŒŸ æ–°å¢åŠŸèƒ½**:
    - **Supervisor Agent**: å…¨å±€å†³ç­–ä¸­æ¢ï¼Œæ¥ç®¡è·¯ç”±åˆ†å‘ä¸çŠ¶æ€æµè½¬ã€‚
    - **Stage & Persona**: åŸºäºæœ‰é™çŠ¶æ€æœº (FSM) çš„å¤šé˜¶æ®µã€å¤šäººè®¾ç®¡ç†ã€‚
    - **Business Metrics**: å®æ—¶ Token æ¶ˆè€—ã€æˆæœ¬ç»Ÿè®¡åŠ Stage æˆæœ¬åˆ†å¸ƒåˆ†æã€‚
    - **Exception Handling**: å¢å¼ºçš„ Supervisor å¼‚å¸¸æ•è·ä¸è‡ªåŠ¨å…œåº• (Fallback) æœºåˆ¶ã€‚
    - **Admin Dashboard**: å…¨æ–°çš„ Streamlit ç®¡ç†åå°ï¼Œé›†æˆç¼–æ’ã€ç›‘æ§ä¸å®¢æœåŠŸèƒ½ã€‚

- **ğŸ”§ æ¶æ„è°ƒæ•´**:
    - æ•°æ®åº“æ¶æ„å‡çº§ï¼š`message_events` è¡¨æ–°å¢ `model`, `cost`, `stage` å­—æ®µã€‚
    - å¼•å…¥ `DatabaseManager` å¤„ç†è‡ªåŠ¨ Schema è¿ç§»ã€‚
    - åºŸå¼ƒç¡¬ç¼–ç çš„å…³é”®è¯å›å¤é€»è¾‘ï¼Œè½¬ä¸º Supervisor åŠ¨æ€å†³ç­–ï¼ˆä¿ç•™å…³é”®è¯ä½œä¸ºè¾…åŠ©ï¼‰ã€‚

- **ğŸ› ä¿®å¤**:
    - ä¿®å¤äº†å¤šè½®å¯¹è¯ä¸­ä¸Šä¸‹æ–‡ä¸¢å¤±çš„é—®é¢˜ã€‚
    - è§£å†³äº†é«˜å¹¶å‘ä¸‹ SQLite é”åº“é—®é¢˜ï¼ˆå¼•å…¥é‡è¯•æœºåˆ¶ï¼‰ã€‚

---

## 2. å‡çº§æ­¥éª¤ (Upgrade Guide)

### å‰ç½®æ¡ä»¶
- Python 3.8+ ç¯å¢ƒ
- OpenAI API Key (æ”¯æŒ GPT-4 æˆ–å…¼å®¹æ¨¡å‹)
- ç°æœ‰ v1.0 æ•°æ®åº“æ–‡ä»¶ (`ai_talk.db`) å»ºè®®å¤‡ä»½

### æ­¥éª¤ä¸€ï¼šæ•°æ®å¤‡ä»½ (å¼ºçƒˆå»ºè®®)
åœ¨æ‰§è¡Œä»»ä½•ä»£ç æ›´æ–°å‰ï¼Œè¯·æ‰‹åŠ¨å¤‡ä»½ SQLite æ•°æ®åº“æ–‡ä»¶ã€‚
```bash
cp ai_talk.db ai_talk.db.bak.v1.0
```

### æ­¥éª¤äºŒï¼šä»£ç æ›´æ–°ä¸ä¾èµ–å®‰è£…
æ‹‰å–æœ€æ–°ä»£ç å¹¶å®‰è£…æ–°å¢ä¾èµ–ï¼ˆä¸»è¦æ˜¯ Streamlit ä¸ Pandasï¼‰ã€‚
```bash
git pull origin main
pip install -r requirements.txt
# ç¡®ä¿åŒ…å«: streamlit, pandas, plotly
```

### æ­¥éª¤ä¸‰ï¼šæ•°æ®åº“è¿ç§» (è‡ªåŠ¨)
v2.0 å¼•å…¥äº†è‡ªåŠ¨è¿ç§»æœºåˆ¶ã€‚åªéœ€å¯åŠ¨ä»»æ„æœåŠ¡ç»„ä»¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶æ›´æ–° Schemaã€‚
```bash
# è¿è¡Œ Streamlit Admin é¢æ¿è§¦å‘è¿ç§»
streamlit run admin_multi.py
```
*è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤å‡ºç° `Migrating table message_events...` å­—æ ·ã€‚*

### æ­¥éª¤å››ï¼šé…ç½®æ›´æ–°
æ£€æŸ¥ `.env` æ–‡ä»¶ï¼Œç¡®ä¿åŒ…å«ä»¥ä¸‹æ–°é…ç½®é¡¹ï¼ˆå¦‚æœ‰ï¼‰ï¼š
```ini
# æ–°å¢ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨ä»£ç å†…ç½®å€¼ï¼‰
SYSTEM_STAGE_TIMEOUT=300
SUPERVISOR_MODEL=gpt-4
```

---

## 3. å›æ»šæ–¹æ¡ˆ (Rollback Plan)

è‹¥å‡çº§åå‡ºç°ä¸¥é‡æ•…éšœï¼ˆå¦‚ Supervisor æŒç»­æŠ¥é”™ã€æ ¸å¿ƒä¸šåŠ¡ä¸­æ–­ï¼‰ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å›æ»šæµç¨‹ã€‚

### æ–¹æ¡ˆ Aï¼šå¿«é€Ÿä»£ç å›æ»š (æ•°æ®å…¼å®¹)
ç”±äº v2.0 ä»…**æ–°å¢**å­—æ®µè€Œéåˆ é™¤æ ¸å¿ƒå­—æ®µï¼Œv1.0 ä»£ç é€šå¸¸å¯ç›´æ¥è¿è¡Œåœ¨ v2.0 æ•°æ®åº“ä¸Šï¼ˆå¿½ç•¥æ–°å­—æ®µï¼‰ã€‚
```bash
git checkout v1.0-tag  # æˆ–å›é€€åˆ°ä¹‹å‰çš„ commit hash
# é‡å¯æœåŠ¡
python main.py
```

### æ–¹æ¡ˆ Bï¼šå®Œæ•´çŠ¶æ€å›æ»š (æ•°æ®æ¢å¤)
è‹¥æ•°æ®åº“ Schema æŸåï¼Œéœ€æ¢å¤å¤‡ä»½ã€‚
1. åœæ­¢æ‰€æœ‰æœåŠ¡ã€‚
2. æ¢å¤æ•°æ®åº“ï¼š
   ```bash
   mv ai_talk.db ai_talk.db.corrupted
   cp ai_talk.db.bak.v1.0 ai_talk.db
   ```
3. å›é€€ä»£ç å¹¶é‡å¯ã€‚

---

## 4. åº”æ€¥å¤„ç†æµç¨‹ (Emergency Procedures)

### åœºæ™¯ 1ï¼šSupervisor Agent æŒç»­å¤±è´¥ (Fallback è§¦å‘)
**ç°è±¡**: ç”¨æˆ·æ”¶åˆ° *"System is currently experiencing high load..."* ä¸”åå°æ— æœ‰æ•ˆå›å¤ã€‚
**å¤„ç†**:
1. æ£€æŸ¥ Admin é¢æ¿ > `Business Metrics`ï¼Œç¡®è®¤ Token é¢åº¦åŠ API è¿é€šæ€§ã€‚
2. æŸ¥çœ‹ `audit_logs` è¡¨ï¼ˆæˆ– Admin é¢æ¿æ—¥å¿—é¡µï¼‰ï¼Œç­›é€‰ `supervisor_error`ã€‚
3. **ä¸´æ—¶è§„é¿**: åœ¨ `config.py` æˆ–ç¯å¢ƒå˜é‡ä¸­å…³é—­ `CONV_ORCHESTRATION` (è®¾ç½®ä¸º False)ï¼Œç³»ç»Ÿå°†é™çº§å› v1.0 çš„ç®€å•å›å¤æ¨¡å¼ï¼ˆå¦‚æ”¯æŒï¼‰ã€‚

### åœºæ™¯ 2ï¼šæ•°æ®åº“é”æ­» (OperationalError: database is locked)
**ç°è±¡**: æ—¥å¿—å¤§é‡æŠ¥é”™ Database Lockedã€‚
**å¤„ç†**:
1. ç¡®ä¿æ²¡æœ‰å…¶ä»– GUI å·¥å…·ï¼ˆå¦‚ DB Browserï¼‰ç‹¬å æ‰“å¼€ `.db` æ–‡ä»¶ã€‚
2. é‡å¯ Python æœåŠ¡è¿›ç¨‹ï¼Œé‡Šæ”¾åƒµæ­»è¿æ¥ã€‚

---

## 5. å…¼å®¹æ€§è¯´æ˜ (Compatibility)

- **æ•°æ®å…¼å®¹æ€§**: v1.0 çš„å†å²æ¶ˆæ¯è®°å½•å®Œå…¨ä¿ç•™ã€‚å‡çº§åï¼Œæ—§æ•°æ®çš„ `stage` å­—æ®µå°†ä¸º `NULL` æˆ–é»˜è®¤å€¼ï¼Œä¸å½±å“ç»Ÿè®¡ã€‚
- **API å…¼å®¹æ€§**: å¯¹å¤– Webhook æ¥å£ä¿æŒä¸å˜ï¼Œç¬¬ä¸‰æ–¹é›†æˆæ— éœ€ä¿®æ”¹ã€‚

---

## 6. æ–‡æ¡£ç´¢å¼• (Documentation Index)

- [ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ (Architecture)](System-Architecture.md)
- [ç®¡ç†åå°æ‰‹å†Œ (Admin Manual)](help_center/v1.0/zh_CN/system_admin.md)
- [ç›‘ç®¡é¢æ¿æŒ‡å— (Supervisor Guide)](help_center/v1.0/zh_CN/supervisor.md)
- [ç¼–æ’é¢æ¿æŒ‡å— (Orchestrator Guide)](help_center/v1.0/zh_CN/orchestrator.md)
